var timeoutRobot;

var Party = {
    isPlaying : false,
    capsPerTurn : 1,
    lives : 60,
    create : function(){
        Viensla.generateCaps();

        Viensla.score = Player.score = Viensla.launched = Player.launched = 0;
        Viensla.lives = Player.lives = Party.lives;

        Party.isPlaying = true;

        this.resetStocks();

        Viensla.isPlaying = false;
        Player.isPlaying = true;

        $vlpart.fadeIn(function(){
            Party.setLife();
        });

        $plpart.fadeIn();

        $('#start-screen').fadeOut();
        $('#black_filter').fadeOut();

        Player.generateCaps();

        setTimeout(function(){
            $('#game-loader .tiny-loader').addClass('fade');

            setTimeout(function(){
                $('#game-loader').addClass('fade');
                setTimeout(function(){
                    $('#game-loader').remove();
                    animTypo($startTypo);

                }, 500);
            }, 1000);
        }, 2000);
    },
    vlplay : function(){

        if(this.isPlaying && CAPS.solo){
            if(Viensla.launched < Party.capsPerTurn && !Player.isPlaying){

                $vlpart.find('.capsstock span').eq(Viensla.launched).removeClass().addClass('animated zoomOut');

                Viensla.isPlaying = true;
                Player.isPlaying = false;
                Viensla.launchCaps();
                Viensla.launched++;
                Viensla.totalLaunched++;

                Player.isPlaying = true;
                Player.launched = 0;
                Viensla.isPlaying = false;
                this.resetStocks();
                $('#turn-m p').text('Your turn!');
                turnm();

            }else{
                console.log('Viens la no more caps !');
            }
        }




    },
    plplay : function(){
        if(this.isPlaying){

            if(Player.launched < Party.capsPerTurn && !Viensla.isPlaying){
                globalDirection = 1;
                create_caps('pl');
                Player.isPlaying = true;
                Viensla.isPlaying = false;
            }
        }
    },

    vlcaps : function(){
        if(this.isPlaying){
            Viensla.isPlaying = false;
            Player.isPlaying = true;
            Viensla.score++;
            Player.drunked += 2;
            Player.lives -= 10;

            this.animCaps();

            if(Viensla.launched < Party.capsPerTurn-1){
                setTimeout(function(){
                    $('#turn-m p').text('Your turn!');
                    turnm();
                },1000);

                setTimeout(function(){
                    Party.resetStocks();
                }, 2000);
            }
            setTimeout(function(){
                Player.generateCaps();
            }, 2000);

            Party.setLife();

        }
    },


    plcaps : function(){
        if(this.isPlaying){
            Player.score++;
            Viensla.lives -= 10;
            Player.isPlaying = false;
            Viensla.isPlaying = true;

            Game.Player.playerCaps();

            this.animCaps();

//            if(Player.launched < Party.capsPerTurn){
//                setTimeout(function(){
//                    $('#turn-m p').text('Vienslà\'s turn!');
//                    turnm();
//                },1000);
//            }
            setTimeout(function(){
                Viensla.generateCaps();
            }, 2000);

            Party.setLife();
        }

    },

    resetStocks : function(){
        if(this.isPlaying){
            console.log('stock reseted');

            $('.capsstock span.zoomOut').removeClass('zoomOut').addClass('zoomIn');

            Viensla.launched = 0;

            Player.launched = 0;


        }

        if(Player.drunked > 11){
            Player.drunked -= 2;
        }
    },

    setLife : function(){
        if(this.isPlaying){
            var pctPlLife = Math.round(Player.lives / Party.lives * 100);
            var pctVlLife = Math.round(Viensla.lives / Party.lives * 100);

            $plpart.find('.life').height(pctPlLife+"%");
            $vlpart.find('.life').height(pctVlLife+"%");

            if(pctPlLife <= 0 || pctVlLife <= 0){
                Party.isPlaying = false;
                console.log('PARTY OVER');

                if(pctPlLife <= 0){
                    $('#winner-m p').text('Vienslà wins !')
                }else if(pctVlLife <= 0){
                    $('#winner-m p').text('You win !')
                }

                winnerm();

                $('#black_filter').fadeIn();
                $('#start-screen').fadeIn();
            }
        }
    },
    animCaps : function(){
        animTypo($capsTypo);
        console.log('anim caps')
        if(!Sounds.mute) Sounds.pschit2.play();
    }
}



var animend ='webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend';

function startm(){
    animTypo($startTypo);
}
function animTypo($el){
    var delay = 400;

    $el.attr('class', 'capsIn1');
    setTimeout(function(){
        $el.attr('class', 'capsIn2');
        setTimeout(function(){
            $el.attr('class', 'capsIn3');
            setTimeout(function(){
                $el.attr('class', '');
            },delay);
        },delay+300);
    },delay);
}
function turnm(){

//    if($('#turn-m').hasClass('bounceOutRight') || $('#turn-m').hasClass('bounceInLeft') ) return;
//
//    $('#turn-m').removeClass().addClass('animated bounceInLeft').show().one(animend, function(){
//        $(this).removeClass().addClass('animated bounceOutRight').one(animend, function(){
//            $(this).removeClass().hide();
//        });
//    });
//    if(!Sounds.mute) Sounds.pschit2.play();
}


function winnerm(){
    $('#winner-m').removeClass().addClass('animated bounceInLeft').show().one(animend, function(){
        $(this).removeClass().addClass('animated bounceOutRight');
    });
    if(!Sounds.mute) Sounds.pschit2.play();
}
